<import name="anu-page-wrapper" src="../../../components/PageWrapper/index.ux"></import>
<template>
    <anu-page-wrapper>
        <div class='city-select'>
            <div class='search-wrapper'><input class="input" type='text' placeholder='搜索目的地'></input>
                <image class="image" src='../../../assets/image/search.png'></image>
            </div>
            <block if="{{state.isSearch}}">
                <div class='search-container'>
                    <block for="(i1985,item) in state.searchResult">
                        <div class='search-result-item'><text>{{item}}</text></div>
                    </block>
                </div>
            </block>
            <block elif="true">
                <div class='city-wrapper'>
                    <block for="(i2411,item) in state.data">
                        <div class='city-item-wrapper'>
                            <div class='title'><text>{{item.title}}</text></div>
                            <div class='city-item'>
                                <block for="(i2822,item) in item.data">
                                    <div onclick="dispatchEvent" class="item" data-click-uid="{{'e90_64_' + i2411 + '-' + i2822}}" data-beacon-uid="default"><text>{{item}}</text></div>
                                </block>
                            </div>
                        </div>
                    </block>
                </div>
            </block>
        </div>
    </anu-page-wrapper>
</template>
<script>
import React from "../../../ReactQuick.js";

function P() {
    this.state = {
        data: [],
        isSearch: false,
        searchResult: []
    };
}

P = React.toClass(P, React.Component, {
    componentDidMount: function() {
        let that = this;
        React.api.showLoading({
            title: '获取资源中',
            mask: true
        });
        React.api.request({
            url: '/18752/qunar/city',
            success: function(data) {
                React.api.hideLoading();
                let curData = that.cleanData(data.data);
                that.setState({
                    data: curData
                });
            }
        });
    },
    cleanData: function(data) {
        let result = [];
        let obj = {};
        data.map(item => {
            if (/[A-Z]/.test(item)) {
                if (item !== 'A') {
                    result.push(obj);
                }

                obj = {};
                obj.title = item;
                obj.data = [];
            } else {
                obj.data.push(item);
            }
        });
        result.push(obj);
        return result;
    },
    itemClick: function(city) {
        React.api.showModal({
            title: '提示',
            content: '当前选择城市为：' + city,
            success: e => {
                if (e.confirm) {
                    var app = React.getApp();
                    app.globalData.citySelect = city;
                    React.api.navigateBack();
                }
            }
        });
    },
    render: function() {
        var h = React.createElement;
        return h("div", {
            class: "city-select"
        }, h("div", {
            class: "search-wrapper"
        }, h("input", {
            class: "input",
            type: "text",
            placeholder: "搜索目的地"
        }), h("image", {
            class: "image",
            src: "../../../assets/image/search.png"
        })), this.state.isSearch ? h("div", {
            class: "search-container"
        }, this.state.searchResult.map(function(item, i1985) {
            return h("div", {
                class: "search-result-item"
            }, item);
        }, this)) : h("div", {
            class: "city-wrapper"
        }, this.state.data.map(function(item, i2411) {
            return h("div", {
                class: "city-item-wrapper"
            }, h("div", {
                class: "title"
            }, item.title), h("div", {
                class: "city-item"
            }, item.data.map(function(item, i2822) {
                return h("div", {
                    onClick: this.itemClick.bind(this, item),
                    class: "item",
                    "data-click-uid": 'e90_64_' + i2411 + '-' + i2822,
                    "data-beacon-uid": "default"
                }, h("text", null, item));
            }, this)));
        }, this)));;
    },
    classUid: "c3880"
}, {});
P = React.registerPage(P, "pages/platform/citySelect/index");
export default P;
</script>
<style>
page {
  background-color: #f0f0f0;
}

.city-select {
  position: relative;
  display: flex;
  justify-content: flex-start;
  align-items: stretch;
  flex-direction: column;
}
.city-select .search-wrapper {
  padding: 20px 30px;
  background-color: #fff;
  font-size: 0;
}
.city-select .search-wrapper .input {
  width: 100%;
  padding: 0 60px;
  margin-right: 20px;
  height: 50px;
  line-height: 50px;
  font-size: 22px;
  text-align: center;
  color: #6c6e6e;
  border-top-left-radius: 25px;
  border-top-right-radius: 25px;
  border-bottom-right-radius: 25px;
  border-bottom-left-radius: 25px;
  background-color: #f1f1f1;
}
.city-select .search-wrapper .image {
  position: absolute;
  top: 30px;
  left: 50px;
  width: 32px;
  height: 32px;
}
.city-select .city-wrapper {
  font-size: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
}
.city-select .city-wrapper .city-item-wrapper {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
}
.city-select .city-wrapper .city-item-wrapper .title {
  padding: 5px 30px;
  font-size: 22px;
  color: #69c0ff;
}
.city-select .city-wrapper .city-item {
  width: 100%;
  padding: 0 30px;
  padding-top: 30px;
  background-color: #fff;
  display: flex;
  flex-wrap: wrap;
  flex-direction: row;
  justify-content: flex-start;
}
.city-select .city-wrapper .city-item .item {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  border-bottom-right-radius: 5px;
  border-bottom-left-radius: 5px;
  border: 2px solid #e6e6e6;
  font-size: 27px;
  margin-right: 20px;
  margin-bottom: 20px;
  padding: 20px 40px;
}
</style>